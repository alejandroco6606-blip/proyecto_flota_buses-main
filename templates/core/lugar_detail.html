{% extends 'base.html' %}

{% block title %}Detalles del Lugar {{ lugar.nombre }} - Sistema de Gestión de Flota{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>
                <i class="fas fa-map-marker-alt me-2"></i>
                Detalles del Lugar - {{ lugar.nombre }}
            </h1>
            <div>
                <a href="{% url 'lugar_list' %}" class="btn btn-secondary me-2">
                    <i class="fas fa-arrow-left me-2"></i>
                    Volver
                </a>
                <a href="{% url 'lugar_update' lugar.pk %}" class="btn btn-warning">
                    <i class="fas fa-edit me-2"></i>
                    Editar
                </a>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-info-circle me-2"></i>
                    Información General
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Nombre del Lugar</label>
                        <div class="fw-bold">{{ lugar.nombre }}</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Ciudad</label>
                        <div class="fw-bold">{{ lugar.ciudad }}</div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Provincia</label>
                        <div class="fw-bold">{{ lugar.provincia|default:"No especificada" }}</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">País</label>
                        <div class="fw-bold">{{ lugar.pais }}</div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Latitud</label>
                        <div class="fw-bold">
                            {% if lugar.latitud %}
                                {{ lugar.latitud|floatformat:6 }}°
                            {% else %}
                                No disponible
                            {% endif %}
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Longitud</label>
                        <div class="fw-bold">
                            {% if lugar.longitud %}
                                {{ lugar.longitud|floatformat:6 }}°
                            {% else %}
                                No disponible
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Registrado en</label>
                        <div class="fw-bold">{{ lugar.creado_en|date:"d/m/Y H:i" }}</div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label text-muted">Coordenadas Completas</label>
                        <div class="fw-bold">
                            {% if lugar.latitud and lugar.longitud %}
                                <a href="https://maps.google.com/?q={{ lugar.latitud }},{{ lugar.longitud }}" target="_blank" class="text-decoration-none">
                                    <i class="fas fa-external-link-alt me-2"></i>
                                    {{ lugar.latitud|floatformat:6 }}, {{ lugar.longitud|floatformat:6 }}
                                </a>
                            {% else %}
                                No disponibles
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mapa (si hay coordenadas) -->
        {% if lugar.latitud and lugar.longitud %}
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-map me-2"></i>
                    Ubicación en el Mapa
                </h5>
            </div>
            <div class="card-body">
                <div class="text-center">
                    <div class="mb-3">
                        <img src="https://maps.googleapis.com/maps/api/staticmap?center={{ lugar.latitud }},{{ lugar.longitud }}&zoom=15&size=600x300&markers=color:red%7Clabel:{{ lugar.nombre|slice:":1" }}%7C{{ lugar.latitud }},{{ lugar.longitud }}&key=YOUR_API_KEY" 
                             alt="Mapa de {{ lugar.nombre }}" 
                             class="img-fluid rounded"
                             style="max-height: 300px; width: 100%; object-fit: cover; background-color: #f8f9fa; border: 1px solid #dee2e6;">
                    </div>
                    <div class="d-flex justify-content-center gap-2">
                        <a href="https://maps.google.com/?q={{ lugar.latitud }},{{ lugar.longitud }}" target="_blank" class="btn btn-primary btn-sm">
                            <i class="fas fa-external-link-alt me-2"></i>
                            Ver en Google Maps
                        </a>
                        <a href="https://www.openstreetmap.org/?mlat={{ lugar.latitud }}&mlon={{ lugar.longitud }}&zoom=15" target="_blank" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-map me-2"></i>
                            Ver en OpenStreetMap
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Sección de Viajes -->
        <div class="card mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-route me-2"></i>
                    Viajes Relacionados
                </h5>
                <button class="btn btn-sm btn-primary">
                    <i class="fas fa-plus me-2"></i>
                    Crear Viaje
                </button>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="border rounded p-3 mb-3">
                            <h6><i class="fas fa-play me-2 text-success"></i>Como Origen</h6>
                            <p class="text-muted mb-1">Viajes que inician en este lugar</p>
                            <span class="badge bg-success">0 viajes</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="border rounded p-3 mb-3">
                            <h6><i class="fas fa-stop me-2 text-danger"></i>Como Destino</h6>
                            <p class="text-muted mb-1">Viajes que terminan en este lugar</p>
                            <span class="badge bg-danger">0 viajes</span>
                        </div>
                    </div>
                </div>
                <p class="text-muted mb-0">No hay viajes registrados para este lugar.</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-cog me-2"></i>
                    Acciones
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'lugar_update' lugar.pk %}" class="btn btn-warning">
                        <i class="fas fa-edit me-2"></i>
                        Editar Lugar
                    </a>
                    {% if lugar.latitud and lugar.longitud %}
                        <a href="https://maps.google.com/maps/dir/?api=1&destination={{ lugar.latitud }},{{ lugar.longitud }}" target="_blank" class="btn btn-info">
                            <i class="fas fa-directions me-2"></i>
                            Obtener Direcciones
                        </a>
                    {% endif %}
                    <button class="btn btn-success">
                        <i class="fas fa-route me-2"></i>
                        Crear Viaje
                    </button>
                    <hr>
                    <a href="{% url 'lugar_delete' lugar.pk %}" class="btn btn-danger">
                        <i class="fas fa-trash me-2"></i>
                        Eliminar Lugar
                    </a>
                </div>
            </div>
        </div>
        
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-chart-bar me-2"></i>
                    Estadísticas
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <small class="text-muted">Total de Viajes</small>
                    <div class="fw-bold">0</div>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Viajes Este Mes</small>
                    <div class="fw-bold">0</div>
                </div>
                <div class="mb-3">
                    <small class="text-muted">Popularidad</small>
                    <div class="fw-bold text-info">
                        <div class="progress" style="height: 20px;">
                            <div class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
                        </div>
                    </div>
                </div>
                <div>
                    <small class="text-muted">Estado</small>
                    <div class="fw-bold text-success">Activo</div>
                </div>
            </div>
        </div>
        
        {% if not lugar.latitud or not lugar.longitud %}
        <div class="card mt-4">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                    Recomendación
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-warning">
                    <small><i class="fas fa-map-marker-alt me-2"></i>Este lugar no tiene coordenadas GPS. Te recomendamos agregarlas para una mejor funcionalidad del sistema.</small>
                </div>
                <a href="{% url 'lugar_update' lugar.pk %}" class="btn btn-sm btn-warning">
                    <i class="fas fa-plus me-2"></i>
                    Agregar Coordenadas
                </a>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}